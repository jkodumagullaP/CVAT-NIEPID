@model IEnumerable<CAT.AID.Models.Candidate>

@{
    ViewBag.Title = "Candidates";
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="fw-bold text-primary">Candidates</h2>

    <a class="btn btn-success fw-bold shadow-sm" href="@Url.Action("Create", "Candidates")">
        ‚ûï Add Candidate
    </a>
</div>

<div class="card shadow-sm">

    <div class="card-body p-0">

        @if (!Model.Any())
        {
            <div class="p-5 text-center text-muted">
                <h5>No candidates available.</h5>
                <p class="small">Click "Add Candidate" to create a new profile.</p>
            </div>
        }
        else
        {
            <table class="table table-hover align-middle mb-0">
                <thead class="table-primary">
                    <tr>
                        <th style="width:70px;">Photo</th>
                        <th>Name & Disability</th>
                        <th>Location</th>
                        <th style="width:130px;">Status</th>
                        <th style="width:140px;">Actions</th>
                    </tr>
                </thead>

                <tbody>
                    @foreach (var c in Model)
                    {
                        var age = DateTime.Now.Year - c.DOB.Year;
                        if (c.DOB.Date > DateTime.Now.AddYears(-age)) age--;

                        <tr>

                            <!-- PHOTO -->
                            <td>
                                <img src="@c.PhotoFilePath"
                                     onerror="this.src='/images/no-photo.png'"
                                     class="rounded shadow-sm border"
                                     style="width:55px;height:65px;object-fit:cover;" />
                            </td>

                            <!-- NAME + DISABILITY -->
                            <td>
                                <div class="fw-bold">@c.FullName</div>
                                <div class="text-muted small">
                                    @c.DisabilityType ‚Ä¢ @age yrs
                                </div>
                            </td>

                            <!-- LOCATION -->
                            <td>
                                <span title="@c.CommunicationAddress">
                                    @((c.CommunicationAddress?.Length > 45)
                                        ? c.CommunicationAddress.Substring(0, 45) + "..."
                                        : c.CommunicationAddress)
                                </span>
                            </td>

                            <!-- STATUS -->
                            <td>
                                @if (!c.IsArchived)
                                {
                                    <span class="badge bg-success px-3 py-2">
                                        ‚úî Active
                                    </span>
                                }
                                else
                                {
                                    <span class="badge bg-danger px-3 py-2">
                                        ‚úñ Blocked
                                    </span>
                                }
                            </td>

                            <!-- ACTIONS -->
                            <td>
                                <div class="dropdown">
                                    <button class="btn btn-outline-secondary btn-sm dropdown-toggle"
                                            data-bs-toggle="dropdown">
                                        ‚ãÆ
                                    </button>

                                    <ul class="dropdown-menu dropdown-menu-end shadow">

                                        <li>
                                            <a class="dropdown-item" href="@Url.Action("Edit", new { id = c.Id })">
                                                ‚úè Edit
                                            </a>
                                        </li>

                                        <li>
                                            <a class="dropdown-item" href="@Url.Action("Details", new { id = c.Id })">
                                                üëÅ View Profile
                                            </a>
                                        </li>

                                        <li>
                                            <a class="dropdown-item" href="@Url.Action("Assign", new { id = c.Id })">
                                                üìù Assign Assessment
                                            </a>
                                        </li>

                                        <li><hr class="dropdown-divider" /></li>

                                        @if (!c.IsArchived)
                                        {
                                            <li>
                                                <a class="dropdown-item text-warning"
                                                   href="@Url.Action("Archive", new { id = c.Id })">
                                                    üö´ Block Candidate
                                                </a>
                                            </li>
                                        }
                                        else
                                        {
                                            <li>
                                                <a class="dropdown-item text-success"
                                                   href="@Url.Action("Unarchive", new { id = c.Id })">
                                                    ‚ôª Restore Candidate
                                                </a>
                                            </li>
                                        }

                                    </ul>
                                </div>
                            </td>

                        </tr>
                    }
                </tbody>
            </table>
        }

    </div>
</div>

<style>
    .table-hover tbody tr:hover {
        background: #f1f7ff;
        transition: 0.2s ease;
    }

    .dropdown-menu a.dropdown-item:hover {
        background: #e2ecff;
        font-weight: 600;
    }
</style>
