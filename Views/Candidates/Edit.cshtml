@using CAT.AID.Models
@model Candidate

<h2 class="mb-4 text-primary fw-bold">
    @(ViewContext.RouteData.Values["action"]?.ToString() == "Create" ? "‚ûï Add Candidate" : "‚úè Edit Candidate")
</h2>

@if (TempData["msg"] != null)
{
    <div class="alert alert-info fw-bold">@TempData["msg"]</div>
}

<form asp-action="@ViewContext.RouteData.Values["action"]" method="post" enctype="multipart/form-data">
    @Html.AntiForgeryToken()
    <div asp-validation-summary="All" class="text-danger fw-bold mb-3"></div>

    <div class="row g-4">

        <!-- LEFT SECTION -->
        <div class="col-lg-8">

            <!-- SECTION 1: IDENTIFICATION -->
            <div class="card shadow-sm border-0">
                <div class="card-header bg-primary text-white fw-bold">Section 1 ‚Äî Identification</div>

                <div class="card-body row g-3">

                    <div class="col-md-6">
                        <label class="form-label fw-bold">Full Name *</label>
                        <input asp-for="FullName" class="form-control" />
                    </div>

                    <div class="col-md-3">
                        <label class="form-label fw-bold">Gender *</label>
                        <select asp-for="Gender" class="form-select">
                            <option value="">-- Select --</option>
                            <option>Male</option>
                            <option>Female</option>
                            <option>Transgender</option>
                        </select>
                    </div>

                    <div class="col-md-3">
                        <label class="form-label fw-bold">Date of Birth *</label>
                        <input asp-for="DOB" type="date" class="form-control" />
                    </div>

                    <div class="col-md-6">
                        <label class="form-label fw-bold">Disability Type *</label>
                        <select asp-for="DisabilityType" class="form-select" required>
                            <option value="">-- Select Disability Type --</option>
                            <option>Intellectual Disability ‚Äì Mild</option>
                            <option>Intellectual Disability ‚Äì Moderate</option>
                            <option>Intellectual Disability ‚Äì Severe</option>
                            <option>Intellectual Disability ‚Äì Profound</option>
                            <option>Multiple Disabilities</option>
                            <option>Autism Spectrum Disorder</option>
                            <option>Cerebral Palsy</option>
                            <option>Down Syndrome</option>
                            <option>Other</option>
                        </select>
                    </div>

                    <div class="col-md-3">
                        <label class="form-label fw-bold">Marital Status</label>
                        <select asp-for="MaritalStatus" class="form-select">
                            <option>Single</option>
                            <option>Married</option>
                            <option>Separated</option>
                            <option>Widow/Widower</option>
                        </select>
                    </div>

                    <div class="col-md-3">
                        <label class="form-label fw-bold">Education</label>
                        <input asp-for="Education" class="form-control" />
                    </div>

                    <div class="col-12 mt-3"><hr /></div>

                    <h5 class="fw-bold text-primary">Parent / Guardian Information</h5>

                    <div class="col-md-6">
                        <label class="form-label fw-bold">Father Name</label>
                        <input asp-for="FatherName" class="form-control" />
                    </div>

                    <div class="col-md-3">
                        <label class="form-label fw-bold">Father Education</label>
                        <input asp-for="FatherEducation" class="form-control" />
                    </div>

                    <div class="col-md-3">
                        <label class="form-label fw-bold">Father Occupation</label>
                        <input asp-for="FatherOccupation" class="form-control" />
                    </div>

                    <div class="col-md-6">
                        <label class="form-label fw-bold">Mother Name</label>
                        <input asp-for="MotherName" class="form-control" />
                    </div>

                    <div class="col-md-3">
                        <label class="form-label fw-bold">Mother Education</label>
                        <input asp-for="MotherEducation" class="form-control" />
                    </div>

                    <div class="col-md-3">
                        <label class="form-label fw-bold">Mother Occupation</label>
                        <input asp-for="MotherOccupation" class="form-control" />
                    </div>

                    <div class="col-md-6">
                        <label class="form-label fw-bold">Mother Tongue</label>
                        <input asp-for="MotherTongue" class="form-control" />
                    </div>

                    <div class="col-md-6">
                        <label class="form-label fw-bold">Other Languages</label>
                        <input asp-for="OtherLanguages" class="form-control" />
                    </div>
                </div>
            </div>

            <!-- SECTION 2: FAMILY HISTORY -->
            <div class="card shadow-sm border-0 mt-4">
                <div class="card-header bg-primary text-white fw-bold">Section 2 ‚Äî Family History</div>

                <div class="card-body row g-3">

                    <div class="col-md-4">
                        <label class="form-label fw-bold">Family Type</label>
                        <select asp-for="FamilyType" class="form-select">
                            <option>Joint</option>
                            <option>Nuclear</option>
                            <option>Single Parent</option>
                        </select>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label fw-bold">Family Disability History</label>
                        <select asp-for="FamilyDisabilityHistory" class="form-select" id="disabilityHistory">
                            <option>No</option>
                            <option>Yes</option>
                        </select>
                    </div>

                    <div class="col-md-4" id="disabilityTypeContainer" style="display:none;">
                        <label class="form-label fw-bold">If Yes, Type</label>
                        <input asp-for="DisabilityType" class="form-control" />
                    </div>

                    <div class="col-md-4">
                        <label class="form-label fw-bold">Monthly Income</label>
                        <input asp-for="MonthlyIncome" class="form-control" />
                    </div>

                    <div class="col-md-4">
                        <label class="form-label fw-bold">Residential Area</label>
                        <select asp-for="ResidentialArea" class="form-select">
                            <option>Rural</option>
                            <option>Semi-Urban</option>
                            <option>Urban</option>
                            <option>Tribal</option>
                            <option>Gated</option>
                        </select>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label fw-bold">Contact Number</label>
                        <input asp-for="ContactNumber" class="form-control" />
                    </div>

                    <div class="col-12">
                        <label class="form-label fw-bold">Communication Address</label>
                        <textarea asp-for="CommunicationAddress" rows="3" class="form-control"></textarea>
                    </div>
                </div>
            </div>

            <!-- SECTION 3: ATTACHMENTS -->
            <div class="card shadow-sm border-0 mt-4">
                <div class="card-header bg-primary text-white fw-bold">Supporting Documents</div>

                <div class="card-body">
                    <div class="row g-3 mb-3">
                        <div class="col-md-8">
                            <input type="file" id="docPicker" accept="image/*,.pdf,.doc,.docx,.xls,.xlsx"
                                   class="form-control" />
                        </div>

                        <div class="col-md-4">
                            <button type="button" class="btn btn-outline-primary w-100 fw-bold" onclick="addDocument()">
                                ‚ûï Add Document
                            </button>
                        </div>
                    </div>

                    <div id="documentsPreview" class="d-flex flex-wrap gap-3"></div>
                    <input type="hidden" id="docCounter" value="0" />
                </div>
            </div>

        </div>

        <!-- PHOTO COLUMN -->
        <div class="col-lg-4">
            <div class="card shadow-sm border-0 p-3 text-center">

                <h5 class="fw-bold">Candidate Photo</h5>

                <img id="photoPreview"
                     src="@(string.IsNullOrEmpty(Model.PhotoFilePath) ? "/images/no-photo.png" : Model.PhotoFilePath)"
                     style="width:170px;height:190px;object-fit:cover;border:1px solid #ccc;border-radius:6px;" />

                <label class="form-label fw-bold mt-3">Upload Photo</label>
                <input type="file" name="PhotoFile" accept="image/*"
                       class="form-control" onchange="previewPhoto(event)" />
            </div>
        </div>
    </div>

    <div class="mt-4">
        <button type="submit" class="btn btn-success px-4 fw-bold">üíæ Save</button>
        <a href="/Candidates" class="btn btn-secondary px-4">Cancel</a>
    </div>
</form>

@section Scripts {
<script>
    function previewPhoto(e) {
        document.getElementById("photoPreview").src =
            URL.createObjectURL(e.target.files[0]);
    }

    document.getElementById("disabilityHistory").addEventListener("change", function () {
        let box = document.getElementById("disabilityTypeContainer");
        box.style.display = this.value === "Yes" ? "block" : "none";
    });
</script>

@await Html.PartialAsync("_ValidationScriptsPartial")
}
